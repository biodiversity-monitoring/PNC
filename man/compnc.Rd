% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/compnc.R
\name{compnc}
\alias{compnc}
\title{Calculate Phylogenetic Niche Conservatism Across Multiple Communities}
\usage{
compnc(
  com,
  trait_data,
  phylo_tree,
  methods = c("Lambda", "K", "K.star", "I", "Cmean"),
  pca_axes = c("PC1", "PC2"),
  sig_levels = c(0.001, 0.01, 0.05),
  min_abundance = 0,
  reps = 999,
  verbose = TRUE
)
}
\arguments{
\item{com}{A community matrix where rows represent sampling plots/sites and columns represent
species. Values indicate species abundance or presence/absence.}

\item{trait_data}{A data frame containing trait measurements for species, where rows are species
and columns are traits. Species names should match those in the community matrix.}

\item{phylo_tree}{A phylogenetic tree object (class "phylo") containing the evolutionary
relationships among species. Tip labels should match species names in the community matrix.}

\item{methods}{Character vector specifying which phylogenetic signal methods to use. Available
options include "Lambda" (Pagel's lambda), "K" (Blomberg's K), "K.star" (standardized K),
"I" (Moran's I), and "Cmean" (mean phylogenetic distance). Default is all methods.}

\item{pca_axes}{Character vector specifying which principal component axes to include in the
analysis (e.g., "PC1", "PC2"). These are calculated automatically from the trait data.}

\item{sig_levels}{Numeric vector of significance levels for statistical testing. Default is
c(0.001, 0.01, 0.05) corresponding to ***, **, and * significance markers.}

\item{min_abundance}{Minimum abundance threshold for including species in the analysis. Species
with abundance below this value are excluded. Default is 0.}

\item{reps}{Number of randomizations for statistical testing. Default is 999.}

\item{verbose}{Logical value indicating whether to display progress information during analysis.
Default is TRUE.}
}
\value{
A data frame with the following columns:
  \describe{
    \item{plot}{Name or identifier of the community/plot}
    \item{trait}{Name of the trait being analyzed}
    \item{coverage}{Percentage of species in the community with available trait data}
    \item{n_sp}{Number of species included in the phylogenetic signal analysis}
    \item{signal}{Calculated phylogenetic signal value}
    \item{p}{P-value from randomization test}
    \item{significance}{Significance level marker (*** for p ≤ 0.001, ** for p ≤ 0.01, * for p ≤ 0.05, ns for non-significant)}
    \item{method}{Statistical method used for calculation}
    \item{n_sp_in_plot}{Total number of species present in the community}
  }
}
\description{
This function conducts comprehensive phylogenetic niche conservatism analysis across multiple
communities simultaneously. It evaluates phylogenetic signal for trait data across different
community assemblages using various statistical methods, enabling comparative assessment of
niche conservatism patterns among communities. The function processes community composition
matrices, species trait information, and phylogenetic trees to determine whether closely
related species consistently occupy similar ecological niches across different habitats
or sampling locations.
}
\details{
The function performs the following steps for each community:
\enumerate{
  \item Species Filtering: Identifies species present in each community based on the minimum abundance threshold.
  \item Data Matching: Matches species between community data, trait data, and phylogenetic tree,
        ensuring only species with complete information are included.
  \item Tree Pruning: Removes species from the phylogenetic tree that are not present in the
        current community.
  \item PCA Analysis: Performs principal component analysis on trait data to extract major axes
        of variation.
  \item Phylogenetic Signal Calculation: Computes phylogenetic signal for each trait using the
        specified methods.
  \item Statistical Testing: Evaluates the significance of phylogenetic signal through
        randomization tests.
}

The function requires a minimum of 4 species with complete data for meaningful analysis.
Results are stored with analysis parameters as attributes.
}
\examples{
# Load example data
data(BCI)
data(TRY)

# Extract trait data
sp <- colnames(BCI$com)
subtraits <- extract_traits(sp, TRY, rank = "species",
                           traits = c("LA", "LMA", "LeafN", "PlantHeight", "SeedMass", "SSD"))

compnc(com = BCI$com, subtraits, BCI$phy_species, methods = "Lambda", pca_axes = NULL)

}
