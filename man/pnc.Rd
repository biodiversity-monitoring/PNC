% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/pnc.R
\name{pnc}
\alias{pnc}
\title{Calculate Phylogenetic Niche Conservatism for Single Community Analysis}
\usage{
pnc(
  trait_data,
  phylo_tree,
  methods = "Lambda",
  pca_axes = c("PC1", "PC2"),
  sig_levels = c(0.001, 0.01, 0.05),
  reps = 999,
  verbose = TRUE
)
}
\arguments{
\item{trait_data}{A data frame containing trait data with species as rows and traits as columns.
Row names should correspond to species names that match the phylogenetic tree tip labels.}

\item{phylo_tree}{A phylogenetic tree object of class "phylo".
Tip labels should match the species names in trait_data row names.}

\item{methods}{A character vector specifying which phylogenetic signal methods to use.
Available options are: "Lambda", "K", "K.star", "I", "Cmean".
Default is "Lambda".}

\item{pca_axes}{A character vector specifying which PCA axes to include in the analysis.
Default is c("PC1", "PC2"). Set to NULL or empty vector to skip PCA analysis.}

\item{sig_levels}{A numeric vector of significance levels for marking results.
Default is c(0.001, 0.01, 0.05) corresponding to ***, **, and * respectively.}

\item{reps}{An integer specifying the number of permutations for significance testing.
Default is 999.}

\item{verbose}{A logical value indicating whether to display progress information and warnings.
Default is TRUE.}
}
\value{
A data frame containing the phylogenetic signal results with the following columns:
  \describe{
    \item{trait}{Character. Name of the trait analyzed}
    \item{coverage}{Character. Percentage of species with valid data for the trait}
    \item{n_sp}{Integer. Number of species included in the analysis}
    \item{signal}{Numeric. Phylogenetic signal value}
    \item{p}{Numeric. P-value from permutation test}
    \item{significance}{Character. Significance level markers (***,**,*,ns)}
    \item{method}{Character. Method used for calculating phylogenetic signal}
  }

  The returned object also contains the following attributes:
  \describe{
    \item{methods}{Character vector of methods used}
    \item{pca_axes}{Character vector of PCA axes requested}
    \item{pca_failed}{Logical indicating if PCA analysis failed}
    \item{sig_levels}{Numeric vector of significance levels used}
    \item{reps}{Integer number of permutations used}
    \item{pca_results}{Data frame of PCA scores (if PCA was successful)}
  }
}
\description{
This function performs in-depth phylogenetic niche conservatism analysis for individual
communities by quantifying phylogenetic signal in trait data using multiple statistical methods.
The function integrates trait data preprocessing, phylogenetic tree manipulation,
optional principal component analysis, and robust statistical testing to provide
detailed insights into evolutionary constraints on niche occupation patterns.
}
\details{
The function performs the following steps:
\enumerate{
  \item Validates input parameters and required packages
  \item Conducts PCA analysis on complete trait data (if requested)
  \item For each trait (original + PCA axes):
    \itemize{
      \item Identifies species with valid trait data
      \item Matches species between trait data and phylogenetic tree
      \item Prunes the phylogenetic tree to include only common species
      \item Calculates phylogenetic signal using specified methods
      \item Performs permutation tests for significance
    }
  \item Compiles results with coverage statistics and significance markers
}

Phylogenetic Signal Methods:
\describe{
  \item{Lambda}{Pagel's lambda - measures the degree to which trait evolution follows Brownian motion}
  \item{K}{Blomberg's K - compares trait variation to that expected under Brownian motion}
  \item{K.star}{Modified K statistic accounting for tree structure}
  \item{I}{Moran's I - measures spatial autocorrelation in trait values}
  \item{Cmean}{Mean of squared changes - measures evolutionary rate}
}

Data Requirements:
\itemize{
  \item Minimum 4 species with valid data for analysis
  \item Species names must match between trait data and phylogenetic tree
  \item Trait data should be numeric
}

PCA Analysis:
If PCA axes are requested, the function performs PCA on complete cases only.
PCA is conducted with scaling and centering. If PCA fails or insufficient
complete data is available, the requested PCA axes will show NA values.
}
\examples{
\dontrun{
# Load example data
data(BCI)
data(TRY)

# Extract trait data
sp <- colnames(BCI$com)
subtraits <- extract_traits(sp, TRY, rank = "species",
                           traits = c("LA", "LMA", "LeafN", "PlantHeight", "SeedMass", "SSD"))

# Calculate phylogenetic signal using Lambda method
pnc(subtraits, BCI$phy_species, methods = "Lambda")

# Calculate without PCA analysis
pnc(subtraits, BCI$phy_species, methods = "Lambda", pca_axes = NULL)
}

}
\references{
Münkemüller, T., Lavergne, S., Bzeznik, B., Dray, S., Jombart, T., Schiffers, K. and Thuiller, W. (2012). How to measure and test phylogenetic signal. Methods in Ecology and Evolution, 3(4), 743-756. \url{https://doi.org/10.1111/j.2041-210X.2012.00196.x}

Keck, F., Rimet, F., Bouchez, A., & Franc, A. (2016). phylosignal: an R package to measure, test, and explore the phylogenetic signal. Ecology and Evolution, 6(9), 2774-2780. \url{https://doi.org/10.1002/ece3.2051}
}
